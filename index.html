<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>善三の日記</title>
<style>
  :root{
    --color-ink:#111;
    --color-overlay: rgba(255,255,255,.28);
    --radius:18px;
    --pad:22px;
    --paper-url: url('paper.jpg');
    --maxw: 780px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:#e7e6e2; color:var(--color-ink);
    font:16px/1.85 ui-serif,"Hiragino Mincho ProN","Yu Mincho",Georgia,serif;
    display:flex; align-items:center; justify-content:center; padding:16px;
  }
  .sheet{
    position:relative; width:100%; max-width:var(--maxw); min-height:70vh;
    border-radius:var(--radius);
    box-shadow:0 18px 40px rgba(0,0,0,.18);
    overflow:hidden; background:#fff;
  }
  .sheet::before{
    content:""; position:absolute; inset:0;
    background-image: var(--paper-url);
    background-size:cover; background-position:center;
    filter:contrast(1.02) saturate(1.02) brightness(1.02);
  }
  .sheet::after{
    content:""; position:absolute; inset:0; background:var(--color-overlay);
  }
  .content{
    position:relative; 
    display:flex;
    flex-direction:column;
    justify-content:center; /* 縦方向中央 */
    align-items:center;     /* 横方向中央 */
    height:100%;            /* 高さ全体で中央寄せ */
    padding: clamp(16px, 3.2vw, var(--pad));
    text-align:center;
  }
  #dateLabel{ margin-bottom:20px; font-size:14px; color:#6b7280; }
  .letter{
    white-space:pre-wrap;
    font-size: clamp(18px,2.5vw,22px);
    line-height: 1.95;
    color: var(--color-ink);
    text-shadow:0 1px 0 rgba(255,255,255,0.75),0 0 1px rgba(0,0,0,0.08);
  }
</style>
</head>
<body>
  <main class="sheet" role="article" aria-label="善三の手紙">
    <div class="content">
      <div id="dateLabel">—</div>
      <section id="letter" class="letter">読み込み中…</section>
    </div>
  </main>

<script>
function getJstDate(d=new Date()){
  const s = d.toLocaleString('en-US',{timeZone:'Asia/Tokyo'});
  return new Date(s);
}
function ymd(date){
  const y=date.getFullYear(), m=String(date.getMonth()+1).padStart(2,'0'), d=String(date.getDate()).padStart(2,'0');
  return `${y}-${m}-${d}`;
}
async function loadLetters(){
  const r=await fetch('letters.json?v='+Date.now(),{cache:'no-store'});
  if(!r.ok) throw new Error('letters.json load failed');
  return r.json();
}

(async function init(){
  const now=getJstDate();
  const todayStr=ymd(now);
  document.getElementById('dateLabel').textContent=todayStr;

  let data;
  try{
    data=await loadLetters();
  }catch(e){
    data={letters:[{text:"（データがありません）"}]};
  }
  const letters=data.letters||[];
  const pool=letters.filter(it=>!it.date);
  const idx=(now.getDate()-1)%Math.max(1,pool.length);
  const chosen=pool[idx]||{text:"（本文なし）"};
  document.getElementById('letter').textContent=chosen.text||"";
})();
</script>
</body>
</html>
