<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>善三の手紙｜日めくり</title>
<style>
  :root{--color-ink:#222;--color-overlay:rgba(255,255,255,.92);--radius:18px;--pad:22px;--paper-url:url('paper.jpg');--maxw:780px}
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:#ecebe7;color:var(--color-ink);font:16px/1.8 ui-serif,"Hiragino Mincho ProN","Yu Mincho",Georgia,serif;display:flex;align-items:center;justify-content:center;padding:16px}
  .sheet{position:relative;width:100%;max-width:var(--maxw);min-height:70vh;border-radius:var(--radius);box-shadow:0 10px 30px rgba(0,0,0,.15);overflow:hidden;background:#fff}
  .sheet::before{content:"";position:absolute;inset:0;background-image:var(--paper-url);background-size:cover;background-position:center}
  .sheet::after{content:"";position:absolute;inset:0;background:var(--color-overlay)}
  .content{position:relative;padding:clamp(14px,3vw,var(--pad))}
  header{display:flex;justify-content:space-between;margin-bottom:12px;font-size:14px;opacity:.8}
  .letter{white-space:pre-wrap;font-size:clamp(16px,2.2vw,20px);line-height:1.9}
  footer{margin-top:18px;font-size:13px;opacity:.7}
</style>
</head>
<body>
  <main class="sheet">
    <div class="content">
      <header>
        <div>山口善三の手紙</div>
        <div id="dateLabel">—</div>
      </header>
      <section id="letter" class="letter">読み込み中…</section>
      <footer id="meta"></footer>
    </div>
  </main>

<script>
function getJstDate(d=new Date()){const s=d.toLocaleString('en-US',{timeZone:'Asia/Tokyo'});return new Date(s)}
function ymd(date){const y=date.getFullYear(),m=String(date.getMonth()+1).padStart(2,'0'),d=String(date.getDate()).padStart(2,'0');return `${y}-${m}-${d}`}
function dayOfYear(date){const start=new Date(date.getFullYear(),0,1);return Math.floor((date-start)/86400000)+1}
async function loadLetters(){const r=await fetch('letters.json?v='+Date.now(),{cache:'no-store'});return r.json()}
(async function init(){
  const now=getJstDate(); const today=ymd(now); const day=dayOfYear(now);
  document.getElementById('dateLabel').textContent=today;
  let data; try{ data=await loadLetters(); }catch{ data={letters:[{text:"データがありません"}]}; }
  const letters=data.letters||[];
  let chosen; const byDate=new Map(); letters.forEach(it=>{ if(it.date) byDate.set(it.date,it); });
  chosen=byDate.get(today);
  if(!chosen){ const pool=letters.filter(it=>!it.date); const idx=(day-1)%Math.max(1,pool.length); chosen=pool[idx]||{text:"データがありません"}; }
  document.getElementById('letter').textContent=chosen.text||""; document.getElementById('meta').textContent=`#day ${day}`;
})();
</script>
</body>
</html>
